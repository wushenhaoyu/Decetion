import{d as T,G as U,aK as A,m as v,V as y,a1 as E,r,o as L,c as z,b as e,w as s,a as B,e as b,u as k,N as I,aL as K,F as M,aM as h,aN as V,X as d,aO as q,S as O}from"./index-jvtWBQTx.js";import{u as $,a as D}from"./tabs-t9v0d24S.js";import{m as G}from"./md5-wN-gQDoO.js";import{_ as H}from"./_plugin-vue_export-helper-x3n3nnut.js";const X={class:"login-btn"},j=T({__name:"LoginForm",setup(J){const m=U(),l=A(),N=$(),S=D(),c=v(),x=y({username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}),i=v(!1),a=y({username:"",password:""}),p=o=>{o&&o.validate(async t=>{if(t){i.value=!0;try{const n=await h({...a,password:G(a.password)});if(!n.success){d({title:V(),message:"账号或密码错误",type:"error",duration:3e3});return}l.setToken(n.access_token),l.$id=n.id,l.setUserInfo({name:n.name}),await q(),N.setTabs([]),S.setKeepAliveName([]),m.push(O),d({title:V(),message:"欢迎登录 "+l.userInfo.name+"医生",type:"success",duration:3e3})}finally{i.value=!1}}})},F=()=>{d({title:"注意",message:"医院认证码请向本院管理员询问",type:"warning",duration:5e3}),m.push("login/register")};return E(()=>{document.onkeydown=o=>{if(o=window.event||o,o.code==="Enter"||o.code==="enter"||o.code==="NumpadEnter"){if(i.value)return;p(c.value)}}}),(o,t)=>{const n=r("user"),_=r("el-icon"),f=r("el-input"),g=r("el-form-item"),R=r("lock"),C=r("el-form"),w=r("el-button");return L(),z(M,null,[e(C,{ref_key:"loginFormRef",ref:c,model:a,rules:x,size:"large"},{default:s(()=>[e(g,{prop:"username"},{default:s(()=>[e(f,{modelValue:a.username,"onUpdate:modelValue":t[0]||(t[0]=u=>a.username=u),placeholder:"邮箱"},{prefix:s(()=>[e(_,{class:"el-input__icon"},{default:s(()=>[e(n)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(g,{prop:"password"},{default:s(()=>[e(f,{modelValue:a.password,"onUpdate:modelValue":t[1]||(t[1]=u=>a.password=u),type:"password",placeholder:"密码","show-password":"",autocomplete:"new-password"},{prefix:s(()=>[e(_,{class:"el-input__icon"},{default:s(()=>[e(R)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),B("div",X,[e(w,{icon:k(I),round:"",size:"large",onClick:F},{default:s(()=>[b(" 注册 ")]),_:1},8,["icon"]),e(w,{icon:k(K),round:"",size:"large",type:"primary",loading:i.value,onClick:t[2]||(t[2]=u=>p(c.value))},{default:s(()=>[b(" 登录 ")]),_:1},8,["icon","loading"])])],64)}}}),Z=H(j,[["__scopeId","data-v-92bfab78"]]);export{Z as default};
